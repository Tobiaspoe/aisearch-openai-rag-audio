name: Deploy to Azure Web App

on:
  push:
    branches:
      - main  # or your deployment branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Log in to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Set Azure Subscription (Optional if not in AZURE_CREDENTIALS)
        run: az account set --subscription ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Create ZIP Package
        run: |
          zip -r app.zip . -x ".git/*" ".github/*" "tests/*"

      - name: Deploy via Azure CLI
        run: |
          az webapp deploy \
            --resource-group finmatch-bsfz \
            --name Finmatcho1--fzulg \
            --src-path app.zip \
            --type zip
